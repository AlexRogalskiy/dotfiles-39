#! /usr/bin/env bash

set -e

today="$(date -u "+%Y-%m-%d")"
backupdir=/Volumes/4_tb_red_src/backups/${today}_macbook_2015

paths=(
  ~/.electrum/wallets
  ~/.electron-cash/wallets
  ~/.gnupg
  ~/.password-store
  ~/.rclone.conf
  ~/.s3cfg
  ~/.serverlessrc
  ~/.ssh
  ~/.task
  ~/.timewarrior
  # ~/Books
  # ~/Contacts
  ~/Desktop
  ~/Documents
  ~/Downloads
  ~/Dropbox\ \(Feram\)
  ~/Dropbox\ \(Personal\)
  # ~/Events
  # ~/Google\ Drive
  ~/Library/autojump
  ~/Library/Fonts
  ~/Library/Keychains
  ~/Library/Thunderbird/Profiles
  ~/Movies
  ~/Music
  # ~/Photos
  ~/Pictures
  ~/Projects
  # ~/Sheetmusic
  # ~/Things
  ~/tasklite
  ~/Wallets
)


if test -d "$backupdir"
then
  echo "Start backup to '$backupdir' …"
else
  echo "'$backupdir' is not a directory!"
  exit 1
fi


for directory in "${paths[@]}"
do
  if test -d "$directory"
  then
    echo "Backing up directory '$directory' …"
    rsync \
      --archive \
      --verbose \
      --stats \
      "$directory" \
      "$backupdir"

  elif test -f "$directory"
  then
    echo "Backing up file '$directory' …"
    cp -v "$directory" "$backupdir"

  else
    echo "Error: '$directory' is not a valid path"
    exit 1
  fi
done


echo "Backing up SD card …"
rsync \
  --archive \
  --verbose \
  --stats \
  "/Volumes/adrian_64gb" \
  "/Volumes/4_tb_red_src/backups/${today}_adrian_64gb"


echo "Sync main 4 TB drive with backup 4 TB drive"  # basically RAID 1
rsync \
  --archive \
  --delete \
  --verbose \
  --stats \
  /Volumes/4_tb_red_src/ \
  /Volumes/4_tb_red_trgt/
